<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cat Adventure </title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            touch-action: none;
        }

        .game-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            aspect-ratio: 16/9;
            border: 4px solid #ff6b9d;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(255, 107, 157, 0.5),
                inset 0 0 20px rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        .title {
            font-size: clamp(12px, 3vw, 24px);
            color: #ff4081;
            text-shadow: 2px 2px 0 #fff, 4px 4px 0 #ff9a9e;
            margin-bottom: 15px;
            text-align: center;
        }

        /* Mobile Controls */
        .mobile-controls {
            display: none;
            width: 100%;
            max-width: 900px;
            padding: 15px;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .control-group {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid #ff6b9d;
            background: linear-gradient(145deg, #fff5f7, #ffe0e8);
            color: #ff4081;
            font-size: 20px;
            font-family: 'Press Start 2P', cursive;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.3);
            transition: all 0.1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            -webkit-user-select: none;
        }

        .control-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(255, 107, 157, 0.4);
        }

        .control-btn.action {
            background: linear-gradient(145deg, #ff6b9d, #ff4081);
            color: white;
            font-size: 12px;
        }

        .control-btn.jump {
            width: 80px;
            height: 80px;
        }

        /* Interact Prompt */
        .interact-prompt {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 25px;
            border-radius: 20px;
            border: 3px solid #ff6b9d;
            font-size: clamp(8px, 2vw, 14px);
            color: #ff4081;
            animation: bounce 0.5s infinite alternate;
            display: none;
            z-index: 10;
            text-align: center;
        }

        @keyframes bounce {
            from {
                transform: translateX(-50%) translateY(0);
            }

            to {
                transform: translateX(-50%) translateY(-10px);
            }
        }

        /* Proposal Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .proposal-modal {
            background: linear-gradient(145deg, #fff5f7, #ffe0e8);
            border: 5px solid #ff6b9d;
            border-radius: 25px;
            padding: 30px;
            max-width: 90%;
            width: 450px;
            text-align: center;
            animation: popIn 0.4s ease-out;
            box-shadow: 0 0 50px rgba(255, 107, 157, 0.6);
        }

        @keyframes popIn {
            from {
                transform: scale(0);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .proposal-character {
            width: 250px;
            height: 250px;
            margin: 0 auto 20px;
            object-fit: contain;
            animation: float 2s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .proposal-text {
            font-size: clamp(10px, 2.5vw, 16px);
            color: #ff4081;
            margin-bottom: 25px;
            line-height: 2;
        }

        .proposal-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .proposal-btn {
            padding: 15px 35px;
            border-radius: 50px;
            border: none;
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(10px, 2vw, 14px);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-yes {
            background: linear-gradient(145deg, #ff6b9d, #ff4081);
            color: white;
            box-shadow: 0 5px 20px rgba(255, 64, 129, 0.4);
        }

        .btn-yes:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(255, 64, 129, 0.6);
        }

        .btn-no {
            background: linear-gradient(145deg, #e0e0e0, #bdbdbd);
            color: #666;
        }

        .btn-no:hover {
            background: linear-gradient(145deg, #bdbdbd, #9e9e9e);
        }

        /* Celebration */
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #ff6b9d 100%);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 200;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .celebration-text {
            font-size: clamp(16px, 5vw, 36px);
            color: white;
            text-shadow: 3px 3px 0 #ff4081, 6px 6px 0 rgba(0, 0, 0, 0.2);
            text-align: center;
            z-index: 10;
            animation: pulse 0.5s infinite alternate;
        }

        @keyframes pulse {
            from {
                transform: scale(1);
            }

            to {
                transform: scale(1.05);
            }
        }

        .heart {
            position: absolute;
            font-size: 30px;
            animation: floatHeart 3s ease-in-out infinite;
            opacity: 0.8;
        }

        @keyframes floatHeart {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
                opacity: 0.8;
            }

            50% {
                transform: translateY(-30px) rotate(15deg);
                opacity: 1;
            }
        }

        /* Celebration Couple Image */
        .couple-image {
            width: clamp(180px, 35vw, 300px);
            height: clamp(180px, 35vw, 300px);
            border-radius: 20px;
            border: 5px solid white;
            box-shadow: 0 10px 50px rgba(255, 64, 129, 0.5);
            object-fit: cover;
            margin-bottom: 20px;
            z-index: 10;
            animation: coupleFloat 2s ease-in-out infinite;
        }

        @keyframes coupleFloat {

            0%,
            100% {
                transform: translateY(0) scale(1);
            }

            50% {
                transform: translateY(-15px) scale(1.02);
            }
        }

        /* Running Cats */
        .running-cat {
            position: absolute;
            width: clamp(60px, 10vw, 100px);
            height: clamp(60px, 10vw, 100px);
            z-index: 5;
            image-rendering: pixelated;
            pointer-events: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .mobile-controls {
                display: flex;
            }

            .game-container {
                border-radius: 8px;
                margin: 10px;
            }

            .title {
                margin-bottom: 10px;
            }
        }

        @media (max-height: 500px) and (orientation: landscape) {
            .game-container {
                max-height: 70vh;
                width: auto;
            }
        }

        /* Instructions */
        .instructions {
            font-size: clamp(6px, 1.5vw, 10px);
            color: #ff6b9d;
            margin-top: 10px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .instructions {
                display: none;
            }
        }
    </style>
</head>

<body>
    <h1 class="title">üíï Cat Adventure üíï</h1>

    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
        <div class="interact-prompt" id="interactPrompt">
            <span class="desktop-text">Press E to Interact</span>
            <span class="mobile-text" style="display: none;">Tap üíï to Interact</span>
        </div>
    </div>

    <p class="instructions">Arrow Keys / WASD to move | E to Interact üíï</p>

    <div class="mobile-controls">
        <div class="control-group">
            <button class="control-btn" id="leftBtn">‚óÄ</button>
            <button class="control-btn" id="rightBtn">‚ñ∂</button>
        </div>
        <button class="control-btn action" id="interactBtn">üíï</button>
    </div>

    <!-- Proposal Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="proposal-modal">
            <img class="proposal-character" id="proposalCharacter" src="" alt="Character">
            <p class="proposal-text">
                üíï My Dearest Ace üíï<br><br>
                Will you be my Valentine? üåπ
            </p>
            <div class="proposal-buttons">
                <button class="proposal-btn btn-yes" id="yesBtn">YES! üíï</button>
                <button class="proposal-btn btn-no" id="noBtn">No...</button>
            </div>
        </div>
    </div>

    <!-- Celebration Screen -->
    <div class="celebration" id="celebration">
        <img class="couple-image" id="coupleImage" src="" alt="Happy Couple">
        <p class="celebration-text">
            üíï YAYYYYYY! üíï<br><br>
            Happy Valentine's Day Po Ace !<br>
            I Will Always Love You Po!üíñüíñ
        </p>
        <canvas id="catsCanvas"></canvas>
    </div>

    <script>
        // Canvas Setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Set canvas resolution
        const GAME_WIDTH = 900;
        const GAME_HEIGHT = 506;
        canvas.width = GAME_WIDTH;
        canvas.height = GAME_HEIGHT;

        // Game State
        let gameState = 'playing'; // playing, proposal, celebration
        let npcIsKneeling = false; // Track if NPC is kneeling
        let assetsLoaded = 0;
        const totalAssets = 8;

        // Assets
        const assets = {
            background: new Image(),
            catIdle: new Image(),
            catJump: new Image(),
            kneel1: new Image(),
            kneel2: new Image(),
            sprite1: new Image(),
            sprite2: new Image(),
            sprite3: new Image()
        };

        // Load Assets
        function loadAssets() {
            assets.background.src = 'images/pixel-sea-landscape-8-bit-sun-beach-with-wave-cloud-and-sand-game-summer-ocean-panorama-cloudy-blue-sky-with-horizon-background-pixels-island-scene-illustration-vector.jpg';
            assets.catIdle.src = 'images/AllCatsDemo/AllCatsDemo/Siamese/IdleCattt.png';
            assets.catJump.src = 'images/AllCatsDemo/AllCatsDemo/Siamese/JumpCatttt.png';
            assets.kneel1.src = 'images/me/kneel1.svg';
            assets.kneel2.src = 'images/me/kneel2.svg';
            assets.sprite1.src = 'images/me/Sprite-0001.svg';
            assets.sprite2.src = 'images/me/Sprite-0002.svg';
            assets.sprite3.src = 'images/me/Sprite-0003.svg';

            Object.values(assets).forEach(img => {
                img.onload = () => {
                    assetsLoaded++;
                    if (assetsLoaded >= totalAssets) {
                        initGame();
                    }
                };
                img.onerror = () => {
                    console.error('Failed to load asset');
                    assetsLoaded++;
                    if (assetsLoaded >= totalAssets) {
                        initGame();
                    }
                };
            });
        }

        // Cat Player
        const cat = {
            x: 100,
            y: GAME_HEIGHT - 150,
            width: 32,
            height: 32,
            velocityX: 0,
            velocityY: 0,
            speed: 5,
            jumpForce: -12,
            gravity: 0.5,
            grounded: false,
            facing: 1, // 1 = right, -1 = left
            state: 'idle', // idle, walking
            frameIndex: 0,
            frameTimer: 0,
            framesPerRow: 7,
            scale: 3 // Normal cat size
        };

        // Ground level
        const GROUND_Y = GAME_HEIGHT - 80;

        // NPC - Much bigger!
        const npc = {
            x: GAME_WIDTH - 400,
            y: GROUND_Y - 350,
            width: 350,
            height: 350,
            frameIndex: 0,
            frameTimer: 0,
            interactionRange: 200
        };

        // Input State
        const keys = {
            left: false,
            right: false,
            jump: false,
            interact: false
        };

        // Keyboard Controls
        document.addEventListener('keydown', (e) => {
            switch (e.code) {
                case 'ArrowLeft':
                case 'KeyA':
                    keys.left = true;
                    break;
                case 'ArrowRight':
                case 'KeyD':
                    keys.right = true;
                    break;
                case 'ArrowUp':
                case 'KeyW':
                case 'Space':
                    e.preventDefault();
                    keys.jump = true;
                    break;
                case 'KeyE':
                    keys.interact = true;
                    break;
            }
        });

        document.addEventListener('keyup', (e) => {
            switch (e.code) {
                case 'ArrowLeft':
                case 'KeyA':
                    keys.left = false;
                    break;
                case 'ArrowRight':
                case 'KeyD':
                    keys.right = false;
                    break;
                case 'ArrowUp':
                case 'KeyW':
                case 'Space':
                    keys.jump = false;
                    break;
                case 'KeyE':
                    keys.interact = false;
                    break;
            }
        });

        // Mobile Controls
        const leftBtn = document.getElementById('leftBtn');
        const rightBtn = document.getElementById('rightBtn');
        const interactBtn = document.getElementById('interactBtn');

        function setupMobileButton(btn, keyName) {
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                keys[keyName] = true;
            });
            btn.addEventListener('touchend', (e) => {
                e.preventDefault();
                keys[keyName] = false;
            });
            btn.addEventListener('mousedown', () => keys[keyName] = true);
            btn.addEventListener('mouseup', () => keys[keyName] = false);
            btn.addEventListener('mouseleave', () => keys[keyName] = false);
        }

        setupMobileButton(leftBtn, 'left');
        setupMobileButton(rightBtn, 'right');
        setupMobileButton(interactBtn, 'interact');

        // Check if mobile
        function isMobile() {
            return window.innerWidth <= 768 || 'ontouchstart' in window;
        }

        // Update mobile instruction text
        if (isMobile()) {
            document.querySelector('.desktop-text').style.display = 'none';
            document.querySelector('.mobile-text').style.display = 'inline';
        }

        // Cat Update - No jumping, just walking!
        function updateCat() {
            // Horizontal movement only
            if (keys.left) {
                cat.velocityX = -cat.speed;
                cat.facing = -1;
            } else if (keys.right) {
                cat.velocityX = cat.speed;
                cat.facing = 1;
            } else {
                cat.velocityX = 0;
            }

            // Apply velocity (horizontal only)
            cat.x += cat.velocityX;

            // Keep cat on ground
            cat.y = GROUND_Y - cat.height;
            cat.grounded = true;

            // Boundary check
            if (cat.x < 0) cat.x = 0;
            if (cat.x > GAME_WIDTH - cat.width) cat.x = GAME_WIDTH - cat.width;

            // Update state - only idle or walking, no jumping
            if (cat.velocityX !== 0) {
                cat.state = 'walking';
            } else {
                cat.state = 'idle';
            }

            // Animation
            cat.frameTimer++;
            if (cat.frameTimer >= 8) {
                cat.frameTimer = 0;
                cat.frameIndex = (cat.frameIndex + 1) % cat.framesPerRow;
            }
        }

        // NPC Update - no animation, just stands normally
        function updateNPC() {
            // NPC doesn't animate anymore - stays on kneel1 until interaction
        }

        // Check Interaction
        function checkInteraction() {
            const catCenterX = cat.x + (cat.width * cat.scale) / 2;
            const npcCenterX = npc.x + npc.width / 2;
            const distance = Math.abs(catCenterX - npcCenterX);

            const prompt = document.getElementById('interactPrompt');

            if (distance < npc.interactionRange) {
                prompt.style.display = 'block';

                if (keys.interact) {
                    keys.interact = false;
                    npcIsKneeling = true; // NPC kneels when interacting!
                    showProposal();
                }
            } else {
                prompt.style.display = 'none';
            }
        }

        // Draw Cat - Always use idle sprite, BIGGER SIZE!
        function drawCat() {
            const sprite = assets.catIdle; // Always idle, no jumping
            const frameWidth = sprite.width / cat.framesPerRow;
            const frameHeight = sprite.height;

            const drawWidth = cat.width * cat.scale;
            const drawHeight = cat.height * cat.scale;

            ctx.save();
            if (cat.facing === -1) {
                ctx.translate(cat.x + drawWidth / 2, 0);
                ctx.scale(-1, 1);
                ctx.drawImage(
                    sprite,
                    cat.frameIndex * frameWidth, 0,
                    frameWidth, frameHeight,
                    -drawWidth / 2, cat.y,
                    drawWidth, drawHeight
                );
            } else {
                ctx.drawImage(
                    sprite,
                    cat.frameIndex * frameWidth, 0,
                    frameWidth, frameHeight,
                    cat.x, cat.y,
                    drawWidth, drawHeight
                );
            }
            ctx.restore();
        }

        // Draw NPC - kneel1 normally, kneel2 when kneeling (after E press)
        function drawNPC() {
            const sprite = npcIsKneeling ? assets.kneel2 : assets.kneel1;
            ctx.drawImage(sprite, npc.x, npc.y, npc.width, npc.height);
        }

        // Draw Background
        function drawBackground() {
            ctx.drawImage(assets.background, 0, 0, GAME_WIDTH, GAME_HEIGHT);
        }

        // Proposal Modal
        let yesButtonScale = 1;
        let noButtonScale = 1; // For shrinking No button
        let noClickCount = 0; // Track no button clicks
        const proposalSprites = [];
        let proposalFrame = 0;
        let proposalTimer = 0;

        function showProposal() {
            gameState = 'proposal';
            document.getElementById('interactPrompt').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'flex';

            // Set initial character image
            updateProposalCharacter();
        }

        function updateProposalCharacter() {
            const sprites = [assets.sprite1, assets.sprite2, assets.sprite3];
            proposalTimer++;
            if (proposalTimer >= 20) {
                proposalTimer = 0;
                proposalFrame = (proposalFrame + 1) % 3;
            }
            document.getElementById('proposalCharacter').src = sprites[proposalFrame].src;
        }

        // Proposal Buttons
        document.getElementById('yesBtn').addEventListener('click', () => {
            showCelebration();
        });

        document.getElementById('noBtn').addEventListener('click', () => {
            noClickCount++;

            // Grow Yes button
            yesButtonScale += 0.4;
            const yesBtn = document.getElementById('yesBtn');
            yesBtn.style.transform = `scale(${yesButtonScale})`;
            yesBtn.style.boxShadow = `0 ${5 * yesButtonScale}px ${20 * yesButtonScale}px rgba(255, 64, 129, 0.6)`;

            // Shrink No button
            noButtonScale = Math.max(0.1, noButtonScale - 0.1);
            const noBtn = document.getElementById('noBtn');
            noBtn.style.transform = `scale(${noButtonScale})`;
            noBtn.style.opacity = noButtonScale;

            // After 10 clicks, No button vanishes completely!
            if (noClickCount >= 10) {
                noBtn.style.display = 'none';
                // Make Yes button pulse to attract attention
                yesBtn.animate([
                    { transform: `scale(${yesButtonScale})`, background: 'linear-gradient(145deg, #ff6b9d, #ff4081)' },
                    { transform: `scale(${yesButtonScale * 1.1})`, background: 'linear-gradient(145deg, #ff4081, #e91e63)' },
                    { transform: `scale(${yesButtonScale})`, background: 'linear-gradient(145deg, #ff6b9d, #ff4081)' }
                ], { duration: 500, iterations: Infinity });
            } else {
                // Add cute shake to Yes button
                yesBtn.animate([
                    { transform: `scale(${yesButtonScale}) rotate(-3deg)` },
                    { transform: `scale(${yesButtonScale}) rotate(3deg)` },
                    { transform: `scale(${yesButtonScale}) rotate(0deg)` }
                ], { duration: 300, easing: 'ease-out' });
            }
        });

        // Celebration
        // Wow animation frames
        const wowFrames = [];
        for (let i = 1; i <= 7; i++) {
            const img = new Image();
            img.src = `images/wow/lalove${i}.jpeg`;
            wowFrames.push(img);
        }
        let wowFrame = 0;
        let wowTimer = 0;

        // Celebration cats
        const celebrationCats = [];
        const catTypes = [
            { idle: 'images/AllCatsDemo/AllCatsDemo/BlackCat/IdleCatb.png', jump: 'images/AllCatsDemo/AllCatsDemo/BlackCat/JumpCabt.png' },
            { idle: 'images/AllCatsDemo/AllCatsDemo/White/IdleCatttt.png', jump: 'images/AllCatsDemo/AllCatsDemo/White/JumpCattttt.png' },
            { idle: 'images/AllCatsDemo/AllCatsDemo/Brown/IdleCattt.png', jump: 'images/AllCatsDemo/AllCatsDemo/Brown/JumpCatttt.png' },
            { idle: 'images/AllCatsDemo/AllCatsDemo/Siamese/IdleCattt.png', jump: 'images/AllCatsDemo/AllCatsDemo/Siamese/JumpCatttt.png' }
        ];

        // Preload cat sprites
        const catSprites = catTypes.map(type => {
            const idle = new Image();
            idle.src = type.idle;
            const jump = new Image();
            jump.src = type.jump;
            return { idle, jump };
        });

        function showCelebration() {
            gameState = 'celebration';
            document.getElementById('modalOverlay').style.display = 'none';
            document.getElementById('celebration').style.display = 'flex';

            // Set initial couple image
            document.getElementById('coupleImage').src = wowFrames[0].src;

            // Create hearts
            for (let i = 0; i < 30; i++) {
                createHeart();
            }

            // Create celebration cats
            for (let i = 0; i < 8; i++) {
                createCelebrationCat();
            }

            // Start wow animation
            animateWow();

            // Start cats animation
            animateCats();
        }

        function animateWow() {
            if (gameState !== 'celebration') return;
            wowTimer++;
            if (wowTimer >= 10) {
                wowTimer = 0;
                wowFrame = (wowFrame + 1) % 7;
                document.getElementById('coupleImage').src = wowFrames[wowFrame].src;
            }
            requestAnimationFrame(animateWow);
        }

        function createCelebrationCat() {
            const catTypeIndex = Math.floor(Math.random() * catSprites.length);
            const cat = {
                x: Math.random() * window.innerWidth,
                y: window.innerHeight - 100 - Math.random() * 50,
                vx: (Math.random() - 0.5) * 8,
                vy: 0,
                jumping: false,
                jumpTimer: Math.random() * 100,
                sprites: catSprites[catTypeIndex],
                frame: 0,
                frameTimer: 0,
                facing: Math.random() > 0.5 ? 1 : -1
            };
            celebrationCats.push(cat);
        }

        function animateCats() {
            if (gameState !== 'celebration') return;

            const celebration = document.getElementById('celebration');

            // Get or create cats canvas
            let catsCanvas = document.getElementById('catsCanvas');
            if (!catsCanvas) {
                catsCanvas = document.createElement('canvas');
                catsCanvas.id = 'catsCanvas';
                celebration.appendChild(catsCanvas);
            }

            // Make canvas full screen and responsive
            catsCanvas.width = window.innerWidth;
            catsCanvas.height = window.innerHeight;
            catsCanvas.style.position = 'absolute';
            catsCanvas.style.top = '0';
            catsCanvas.style.left = '0';
            catsCanvas.style.width = '100%';
            catsCanvas.style.height = '100%';
            catsCanvas.style.pointerEvents = 'none';
            catsCanvas.style.zIndex = '5';

            const catsCtx = catsCanvas.getContext('2d');
            catsCtx.clearRect(0, 0, catsCanvas.width, catsCanvas.height);

            // Responsive values based on screen size
            const catSize = Math.max(50, Math.min(80, window.innerWidth * 0.08));
            const groundY = window.innerHeight - catSize - 30;
            const jumpVelocity = -window.innerHeight * 0.018; // Responsive jump height
            const gravity = window.innerHeight * 0.0008; // Responsive gravity
            const moveSpeed = window.innerWidth * 0.003; // Responsive speed

            celebrationCats.forEach(cat => {
                // Initialize ground position if not set
                if (!cat.groundY) cat.groundY = groundY;

                // Responsive movement speed
                if (!cat.speedSet) {
                    cat.vx = (Math.random() - 0.5) * moveSpeed * 2;
                    if (Math.abs(cat.vx) < moveSpeed * 0.3) {
                        cat.vx = moveSpeed * (Math.random() > 0.5 ? 1 : -1);
                    }
                    cat.speedSet = true;
                }

                // Movement
                cat.x += cat.vx;

                // Wrap around screen
                if (cat.x < -catSize) cat.x = window.innerWidth;
                if (cat.x > window.innerWidth) cat.x = -catSize;

                // Random jumping with responsive timing
                cat.jumpTimer--;
                if (cat.jumpTimer <= 0 && !cat.jumping) {
                    cat.jumping = true;
                    cat.vy = jumpVelocity * (0.8 + Math.random() * 0.4);
                    cat.groundY = groundY;
                    cat.jumpFrame = 0; // Reset jump animation frame
                }

                // Gravity for jumping
                if (cat.jumping) {
                    cat.vy += gravity;
                    cat.y += cat.vy;

                    // Jump sprite animation (cycle through jump frames)
                    cat.jumpFrameTimer = (cat.jumpFrameTimer || 0) + 1;
                    if (cat.jumpFrameTimer >= 6) {
                        cat.jumpFrameTimer = 0;
                        cat.jumpFrame = Math.min((cat.jumpFrame || 0) + 1, 6);
                    }

                    if (cat.y >= groundY) {
                        cat.y = groundY;
                        cat.jumping = false;
                        cat.jumpTimer = 40 + Math.random() * 80;
                        cat.vy = 0;
                        cat.jumpFrame = 0;
                    }
                } else {
                    cat.y = groundY;

                    // Idle/run animation
                    cat.frameTimer++;
                    if (cat.frameTimer >= 8) {
                        cat.frameTimer = 0;
                        cat.frame = (cat.frame + 1) % 7;
                    }
                }

                // Facing direction based on velocity
                if (cat.vx !== 0) {
                    cat.facing = cat.vx > 0 ? 1 : -1;
                }

                // Draw cat sprite using canvas
                const sprite = cat.jumping ? cat.sprites.jump : cat.sprites.idle;
                const currentFrame = cat.jumping ? (cat.jumpFrame || 0) : cat.frame;

                if (sprite.complete && sprite.naturalWidth > 0) {
                    const frameWidth = sprite.width / 7;
                    const frameHeight = sprite.height;

                    catsCtx.save();
                    catsCtx.translate(cat.x + catSize / 2, cat.y);
                    catsCtx.scale(cat.facing, 1);
                    catsCtx.drawImage(
                        sprite,
                        currentFrame * frameWidth, 0,
                        frameWidth, frameHeight,
                        -catSize / 2, 0,
                        catSize, catSize
                    );
                    catsCtx.restore();
                }
            });

            requestAnimationFrame(animateCats);
        }

        function createHeart() {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.textContent = ['üíï', '‚ù§Ô∏è', 'üíñ', 'üíó', 'üíì'][Math.floor(Math.random() * 5)];
            heart.style.left = Math.random() * 100 + '%';
            heart.style.top = Math.random() * 100 + '%';
            heart.style.animationDelay = Math.random() * 2 + 's';
            heart.style.fontSize = (20 + Math.random() * 30) + 'px';
            document.getElementById('celebration').appendChild(heart);
        }

        // Game Loop
        function gameLoop() {
            if (gameState === 'playing') {
                updateCat();
                updateNPC();
                checkInteraction();
            } else if (gameState === 'proposal') {
                updateProposalCharacter();
            }

            // Draw
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            drawBackground();
            drawNPC();
            drawCat();

            requestAnimationFrame(gameLoop);
        }

        // Init
        function initGame() {
            console.log('All assets loaded! Starting game...');
            gameLoop();
        }

        // Start loading
        loadAssets();
    </script>
</body>

</html>